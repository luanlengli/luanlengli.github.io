<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Linux,CUDA,"><meta name="description" content="说明理论上适用于其他云平台的GPU计算型实例或者自建GPU计算服务器阿里云实例类型GPU计算型 gn5GPU型号Nvidia Tesla P100操作系统CentOS-7.7-1908 64位Nvidia驱动版本390.116CUDA Driver版本9.1.85CUDA Runtime版本9.0.176cuDNN版本v7.6.0.64Nvidia GPU 兼容性的可以看这篇文章GPU驱动、CUD"><meta name="keywords" content="Linux,CUDA"><meta property="og:type" content="article"><meta property="og:title" content="阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA"><meta property="og:url" content="https://luanlengli.github.io/2019/12/31/阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA.html"><meta property="og:site_name" content="luanlengli&#39;s Blog"><meta property="og:description" content="说明理论上适用于其他云平台的GPU计算型实例或者自建GPU计算服务器阿里云实例类型GPU计算型 gn5GPU型号Nvidia Tesla P100操作系统CentOS-7.7-1908 64位Nvidia驱动版本390.116CUDA Driver版本9.1.85CUDA Runtime版本9.0.176cuDNN版本v7.6.0.64Nvidia GPU 兼容性的可以看这篇文章GPU驱动、CUD"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2020-01-01T03:51:15.487Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA"><meta name="twitter:description" content="说明理论上适用于其他云平台的GPU计算型实例或者自建GPU计算服务器阿里云实例类型GPU计算型 gn5GPU型号Nvidia Tesla P100操作系统CentOS-7.7-1908 64位Nvidia驱动版本390.116CUDA Driver版本9.1.85CUDA Runtime版本9.0.176cuDNN版本v7.6.0.64Nvidia GPU 兼容性的可以看这篇文章GPU驱动、CUD"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://luanlengli.github.io/2019/12/31/阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA.html"><title>阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA | luanlengli's Blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">luanlengli's Blog</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">“不知道”的五大理由，不读，不查，不试，理解能力差，满脑子想着怎么利用他人</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://luanlengli.github.io/2019/12/31/阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="乱愣黎"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="luanlengli's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-31T23:40:43+08:00">2019-12-31 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2020-01-01T11:51:15+08:00">2020-01-01 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span> </a></span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/CUDA/" itemprop="url" rel="index"><span itemprop="name">CUDA</span> </a></span></span><span id="/2019/12/31/阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA.html" class="leancloud_visitors" data-flag-title="阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数&#58;</span> <span class="leancloud-visitors-count"></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">2.9k</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><ul><li>理论上适用于其他云平台的<code>GPU计算型实例</code>或者<code>自建GPU计算服务器</code></li><li>阿里云实例类型<code>GPU计算型 gn5</code></li><li>GPU型号<code>Nvidia Tesla P100</code></li><li>操作系统<code>CentOS-7.7-1908 64位</code></li><li>Nvidia驱动版本<code>390.116</code></li><li>CUDA Driver版本<code>9.1.85</code></li><li>CUDA Runtime版本<code>9.0.176</code></li><li>cuDNN版本<code>v7.6.0.64</code></li><li>Nvidia GPU 兼容性的可以看<a href="http://wsfdl.com/kubernetes/2019/05/08/versions_in_gpu.html" target="_blank" rel="noopener">这篇文章</a></li><li><font color="red">GPU驱动、CUDA、cuDNN版本的选择，请自行根据项目要求进行调整！</font></li></ul><h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="禁用SELINUX"><a href="#禁用SELINUX" class="headerlink" title="禁用SELINUX"></a>禁用SELINUX</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i 's,^SELINUX=.*,SELINUX=disabled,g' /etc/selinux/config</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure><h2 id="禁用防火墙"><a href="#禁用防火墙" class="headerlink" title="禁用防火墙"></a>禁用防火墙</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable --now firewalld.service</span><br></pre></td></tr></table></figure><h2 id="添加sysctl参数"><a href="#添加sysctl参数" class="headerlink" title="添加sysctl参数"></a>添加sysctl参数</h2><h3 id="fs参数"><a href="#fs参数" class="headerlink" title="fs参数"></a>fs参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysctl.d/99-fs.conf &lt;&lt;EOF</span><br><span class="line"><span class="meta">#</span><span class="bash"> 最大文件句柄数</span></span><br><span class="line">fs.file-max=1048576</span><br><span class="line"><span class="meta">#</span><span class="bash"> 最大文件打开数</span></span><br><span class="line">fs.nr_open=1048576</span><br><span class="line"><span class="meta">#</span><span class="bash"> 同一时间异步IO请求数</span></span><br><span class="line">fs.aio-max-nr=1048576</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在CentOS7.4引入了一个新的参数来控制内核的行为。 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /proc/sys/fs/may_detach_mounts 默认设置为0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当系统有容器运行的时候，需要将该值设置为1。</span></span><br><span class="line">fs.may_detach_mounts=1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="vm参数"><a href="#vm参数" class="headerlink" title="vm参数"></a>vm参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysctl.d/99-vm.conf &lt;&lt;EOF</span><br><span class="line"><span class="meta">#</span><span class="bash"> 内存耗尽才使用swap分区</span></span><br><span class="line">vm.swappiness=10</span><br><span class="line"><span class="meta">#</span><span class="bash"> 当内存耗尽时，内核会触发OOM killer根据oom_score杀掉最耗内存的进程</span></span><br><span class="line">vm.panic_on_oom=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许overcommit</span></span><br><span class="line">vm.overcommit_memory=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 定义了进程能拥有的最多内存区域，默认65536</span></span><br><span class="line">vm.max_map_count=262144</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="net参数"><a href="#net参数" class="headerlink" title="net参数"></a>net参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysctl.d/99-net.conf &lt;&lt;EOF</span><br><span class="line"><span class="meta">#</span><span class="bash"> 二层的网桥在转发包时也会被iptables的FORWARD规则所过滤</span></span><br><span class="line">net.bridge.bridge-nf-call-arptables=1</span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭严格校验数据包的反向路径，默认值1</span></span><br><span class="line">net.ipv4.conf.default.rp_filter=0</span><br><span class="line">net.ipv4.conf.all.rp_filter=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进程间通信发送数据, 默认100</span></span><br><span class="line">net.unix.max_dgram_qlen=512</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置 conntrack 的上限</span></span><br><span class="line">net.netfilter.nf_conntrack_max=1048576</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置连接跟踪表中处于TIME_WAIT状态的超时时间</span></span><br><span class="line">net.netfilter.nf_conntrack_tcp_timeout_timewait=30</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置连接跟踪表中TCP连接超时时间</span></span><br><span class="line">net.netfilter.nf_conntrack_tcp_timeout_established=1200</span><br><span class="line"><span class="meta">#</span><span class="bash"> 端口最大的监听队列的长度</span></span><br><span class="line">net.core.somaxconn=21644</span><br><span class="line"><span class="meta">#</span><span class="bash"> 接收自网卡、但未被内核协议栈处理的报文队列长度</span></span><br><span class="line">net.core.netdev_max_backlog=262144</span><br><span class="line"><span class="meta">#</span><span class="bash"> 系统无内存压力、启动压力模式阈值、最大值，单位为页的数量</span></span><br><span class="line"><span class="meta">#</span><span class="bash">net.ipv4.tcp_mem=1541646 2055528 3083292</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 内核socket接收缓存区字节数min/default/max</span></span><br><span class="line">net.core.rmem=4096 65536 8388608</span><br><span class="line"><span class="meta">#</span><span class="bash"> 内核socket发送缓存区字节数min/default/max</span></span><br><span class="line">net.core.wmem=4096 65536 8388608</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启自动调节缓存模式</span></span><br><span class="line">net.ipv4.tcp_moderate_rcvbuf=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP阻塞控制算法BBR，Linux内核版本4.9开始内置BBR算法</span></span><br><span class="line"><span class="meta">#</span><span class="bash">net.ipv4.tcp_congestion_control=bbr</span></span><br><span class="line"><span class="meta">#</span><span class="bash">net.core.default_qdisc=fq</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 用作本地随机TCP端口的范围</span></span><br><span class="line">net.ipv4.ip_local_port_range=10000 65000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打开ipv4数据包转发</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许应用程序能够绑定到不属于本地网卡的地址</span></span><br><span class="line">net.ipv4.ip_nonlocal_bind=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 系统中处于 SYN_RECV 状态的 TCP 连接数量</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog=16384</span><br><span class="line"><span class="meta">#</span><span class="bash"> 内核中管理 TIME_WAIT 状态的数量</span></span><br><span class="line">net.ipv4.tcp_max_tw_buckets=5000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定重发 SYN/ACK 的次数</span></span><br><span class="line">net.ipv4.tcp_synack_retries=2</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP连接中TIME_WAIT sockets的快速回收</span></span><br><span class="line">net.ipv4.tcp_tw_recycle=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 不属于任何进程的tcp socket最大数量. 超过这个数量的socket会被reset, 并告警</span></span><br><span class="line">net.ipv4.tcp_max_orphans=1024</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP FIN报文重试次数</span></span><br><span class="line">net.ipv4.tcp_orphan_retries=8</span><br><span class="line"><span class="meta">#</span><span class="bash"> 加快系统关闭处于 FIN_WAIT2 状态的 TCP 连接</span></span><br><span class="line">net.ipv4.tcp_fin_timeout=15</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP连接keepalive的持续时间，默认7200</span></span><br><span class="line">net.ipv4.tcp_keepalive_time=600</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP keepalive探测包发送间隔</span></span><br><span class="line">net.ipv4.tcp_keepalive_intvl=30</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP keepalive探测包重试次数</span></span><br><span class="line">net.ipv4.tcp_keepalive_probes=10</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP FastOpen</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 0:关闭 ; 1:作为客户端时使用 ; 2:作为服务器端时使用 ; 3:无论作为客户端还是服务器端都使用</span></span><br><span class="line">net.ipv4.tcp_fastopen=3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 限制TCP重传次数</span></span><br><span class="line">net.ipv4.tcp_retries1=3</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP重传次数到达上限时，关闭TCP连接</span></span><br><span class="line">net.ipv4.tcp_retries2=15</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="修改limits参数"><a href="#修改limits参数" class="headerlink" title="修改limits参数"></a>修改limits参数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/security/limits.d/99-centos.conf &lt;&lt;EOF</span><br><span class="line">* - nproc 1048576</span><br><span class="line">* - nofile 1048576</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="修改journal设置"><a href="#修改journal设置" class="headerlink" title="修改journal设置"></a>修改journal设置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -e 's,^#Compress=yes,Compress=yes,' \</span><br><span class="line">    -e 's,^#SystemMaxUse=,SystemMaxUse=2G,' \</span><br><span class="line">    -e 's,^#Seal=yes,Seal=yes,' \</span><br><span class="line">    -e 's,^#RateLimitBurst=1000,RateLimitBurst=5000,' \</span><br><span class="line">    -i /etc/systemd/journald.conf</span><br></pre></td></tr></table></figure><h2 id="修改history参数"><a href="#修改history参数" class="headerlink" title="修改history参数"></a>修改history参数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/profile.d/history.sh &lt;&lt;EOF</span><br><span class="line">export HISTSIZE=10000</span><br><span class="line">export HISTFILESIZE=10000</span><br><span class="line">export HISTCONTROL=ignoredups</span><br><span class="line">export HISTTIMEFORMAT="`whoami` %F %T "</span><br><span class="line">export HISTIGNORE="ls:pwd:ll:ls -l:ls -a:ll -a"</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="更新软件"><a href="#更新软件" class="headerlink" title="更新软件"></a>更新软件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update -y</span><br></pre></td></tr></table></figure><h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groups install base 'Development Tools'</span><br></pre></td></tr></table></figure><h2 id="安装常用工具"><a href="#安装常用工具" class="headerlink" title="安装常用工具"></a>安装常用工具</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nc \</span><br><span class="line">               git \</span><br><span class="line">               vim \</span><br><span class="line">               ipvsadm \</span><br><span class="line">               tree \</span><br><span class="line">               dstat \</span><br><span class="line">               iotop \</span><br><span class="line">               htop \</span><br><span class="line">               socat \</span><br><span class="line">               ipset\</span><br><span class="line">               conntrack \</span><br><span class="line">               bash-completion-extras \</span><br><span class="line">               tcpdump \</span><br><span class="line">               wireshark \</span><br><span class="line">               bcc-tools \</span><br><span class="line">               perf \</span><br><span class="line">               trace-cmd \</span><br><span class="line">               systemtap \</span><br><span class="line">               nethogs \</span><br><span class="line">               lshw</span><br></pre></td></tr></table></figure><h2 id="检查GPU"><a href="#检查GPU" class="headerlink" title="检查GPU"></a>检查GPU</h2><h3 id="查看PCI设备"><a href="#查看PCI设备" class="headerlink" title="查看PCI设备"></a>查看PCI设备</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci | grep -i nvidia</span><br></pre></td></tr></table></figure><blockquote><p>输出示例</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00:08.0 3D controller: NVIDIA Corporation GP100GL [Tesla P100 PCIe 16GB] (rev a1)</span><br></pre></td></tr></table></figure><h3 id="查看硬件信息"><a href="#查看硬件信息" class="headerlink" title="查看硬件信息"></a>查看硬件信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lshw -numeric -C display</span><br></pre></td></tr></table></figure><blockquote><p>输出示例</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">*-display:0               </span><br><span class="line">     description: VGA compatible controller</span><br><span class="line">     product: GD 5446 [1013:B8]</span><br><span class="line">     vendor: Cirrus Logic [1013]</span><br><span class="line">     physical id: 2</span><br><span class="line">     bus info: pci@0000:00:02.0</span><br><span class="line">     version: 00</span><br><span class="line">     width: 32 bits</span><br><span class="line">     clock: 33MHz</span><br><span class="line">     capabilities: vga_controller rom</span><br><span class="line">     configuration: driver=cirrus latency=0</span><br><span class="line">     resources: irq:0 memory:fa000000-fbffffff memory:fe850000-fe850fff memory:fe840000-fe84ffff</span><br><span class="line">*-display:1</span><br><span class="line">     description: 3D controller</span><br><span class="line">     product: GP100GL [Tesla P100 PCIe 16GB] [10DE:15F8]</span><br><span class="line">     vendor: NVIDIA Corporation [10DE]</span><br><span class="line">     physical id: 8</span><br><span class="line">     bus info: pci@0000:00:08.0</span><br><span class="line">     logical name: /dev/fb0</span><br><span class="line">     version: a1</span><br><span class="line">     width: 64 bits</span><br><span class="line">     clock: 33MHz</span><br><span class="line">     capabilities: pm msi pciexpress bus_master cap_list fb</span><br><span class="line">     configuration: depth=16 driver=nvidia latency=0 mode=1024x768 visual=truecolor xres=1024 yres=768</span><br><span class="line">     resources: iomemory:100-ff iomemory:140-13f irq:11 memory:fd000000-fdffffff memory:1000000000-13ffffffff memory:1400000000-1401ffffff</span><br></pre></td></tr></table></figure><h2 id="禁用nouveau驱动"><a href="#禁用nouveau驱动" class="headerlink" title="禁用nouveau驱动"></a>禁用nouveau驱动</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo "blacklist nouveau" &gt; /etc/modprobe.d/blacklist-nouveau.conf</span><br><span class="line">echo "options nouveau modeset=0" &gt;&gt; /etc/modprobe.d/blacklist-nouveau.conf</span><br><span class="line">rmmod nouveau</span><br><span class="line">dracut --force</span><br></pre></td></tr></table></figure><h2 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><h1 id="安装GPU驱动"><a href="#安装GPU驱动" class="headerlink" title="安装GPU驱动"></a>安装GPU驱动</h1><h2 id="访问Nvidia官网"><a href="#访问Nvidia官网" class="headerlink" title="访问Nvidia官网"></a>访问Nvidia官网</h2><p><a href="https://www.nvidia.cn/Download/index.aspx?lang=cn" target="_blank" rel="noopener">Nvidia驱动程序下载</a></p><h2 id="下载驱动"><a href="#下载驱动" class="headerlink" title="下载驱动"></a>下载驱动</h2><h3 id="网页下载"><a href="#网页下载" class="headerlink" title="网页下载"></a>网页下载</h3><ol><li>产品类型<code>Tesla</code></li><li>产品类型<code>P-Series</code></li><li>产品家族<code>Tesla P100</code></li><li>操作系统<code>Linux 64-bit RHEL7</code></li><li>CUDA Toolkit<code>9.1</code></li><li>点击<code>搜索</code>，跳转到<code>驱动程序下载</code>页面</li><li>点击<code>下载</code>，跳转到<code>驱动下载</code></li><li>再次点击<code>下载</code>，保存驱动文件</li></ol><h3 id="命令行下载"><a href="#命令行下载" class="headerlink" title="命令行下载"></a>命令行下载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -t 10 --timeout=10 http://cn.download.nvidia.com/tesla/390.116/nvidia-diag-driver-local-repo-rhel7-390.116-1.0-1.x86_64.rpm</span><br></pre></td></tr></table></figure><h2 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install nvidia-diag-driver-local-repo-rhel7-390.116-1.0-1.x86_64.rpm</span><br><span class="line">yum clean all</span><br><span class="line">yum install cuda-drivers-390.116-1.x86_64</span><br></pre></td></tr></table></figure><h2 id="重启-1"><a href="#重启-1" class="headerlink" title="重启"></a>重启</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="检查驱动情况"><a href="#检查驱动情况" class="headerlink" title="检查驱动情况"></a>检查驱动情况</h2><h3 id="检查是否加载开源驱动nouveau"><a href="#检查是否加载开源驱动nouveau" class="headerlink" title="检查是否加载开源驱动nouveau"></a>检查是否加载开源驱动nouveau</h3><blockquote><p>这里不应该有结果输出！</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep nouveau</span><br></pre></td></tr></table></figure><h3 id="检查驱动版本"><a href="#检查驱动版本" class="headerlink" title="检查驱动版本"></a>检查驱动版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/driver/nvidia/version</span><br></pre></td></tr></table></figure><blockquote><p>输出示例</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NVRM version: NVIDIA UNIX x86_64 Kernel Module  390.116  Sun Jan 27 07:21:36 PST 2019</span><br><span class="line">GCC version:  gcc version 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC)</span><br></pre></td></tr></table></figure><h3 id="查看GPU信息"><a href="#查看GPU信息" class="headerlink" title="查看GPU信息"></a>查看GPU信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi</span><br></pre></td></tr></table></figure><blockquote><p>输出示例</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 390.116                Driver Version: 390.116                   |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|===============================+======================+======================|</span><br><span class="line">|   0  Tesla P100-PCIE...  Off  | 00000000:00:08.0 Off |                    0 |</span><br><span class="line">| N/A   32C    P0    27W / 250W |      0MiB / 16280MiB |      3%      Default |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">                                                                               </span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                       GPU Memory |</span><br><span class="line">|  GPU       PID   Type   Process name                             Usage      |</span><br><span class="line">|=============================================================================|</span><br><span class="line">|  No running processes found                                                 |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><h2 id="禁用本地YUM源"><a href="#禁用本地YUM源" class="headerlink" title="禁用本地YUM源"></a>禁用本地YUM源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --disable nvidia-diag-driver-local-390.116</span><br></pre></td></tr></table></figure><h1 id="安装CUDA"><a href="#安装CUDA" class="headerlink" title="安装CUDA"></a>安装CUDA</h1><h2 id="添加CUDA源"><a href="#添加CUDA源" class="headerlink" title="添加CUDA源"></a>添加CUDA源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http://developer.download.nvidia.com/compute/cuda/repos/rhel7/x86_64/cuda-rhel7.repo</span><br></pre></td></tr></table></figure><h2 id="修改CUDA源地址"><a href="#修改CUDA源地址" class="headerlink" title="修改CUDA源地址"></a>修改CUDA源地址</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -e 's,developer.download.nvidia.cn/compute/cuda/repos/,mirrors.aliyun.com/nvidia-cuda,g' \</span><br><span class="line">    -e 's,developer.download.nvidia.com/compute/cuda/repos,mirrors.aliyun.com/nvidia-cuda,g' \</span><br><span class="line">    -i /etc/yum.repos.d/cuda-rhel7.repo</span><br></pre></td></tr></table></figure><h2 id="安装CUDA-1"><a href="#安装CUDA-1" class="headerlink" title="安装CUDA"></a>安装CUDA</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br><span class="line">yum install cuda-9-0</span><br></pre></td></tr></table></figure><h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo 'export PATH=/usr/local/cuda-9.0/bin:$PATH' &gt;&gt; /etc/profile.d/cuda-9.0.sh</span><br><span class="line">echo 'export LD_LIBRARY_PATH=/usr/local/cuda-9.0/lib64:$LD_LIBRARY_PATH' &gt;&gt; /etc/profile.d/cuda-9.0.sh</span><br><span class="line">source /etc/profile.d/cuda-9.0.sh</span><br></pre></td></tr></table></figure><h2 id="测试CUDA"><a href="#测试CUDA" class="headerlink" title="测试CUDA"></a>测试CUDA</h2><h3 id="查看安装路径"><a href="#查看安装路径" class="headerlink" title="查看安装路径"></a>查看安装路径</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -ld /usr/local/cuda*</span><br></pre></td></tr></table></figure><blockquote><p>输出示例</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lrwxrwxrwx  1 root root    8 Jan  1 11:08 /usr/local/cuda -&gt; cuda-9.0</span><br><span class="line">drwxr-xr-x 15 root root 4096 Jan  1 11:08 /usr/local/cuda-9.0</span><br></pre></td></tr></table></figure><h3 id="检查CUDA版本"><a href="#检查CUDA版本" class="headerlink" title="检查CUDA版本"></a>检查CUDA版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc --version</span><br></pre></td></tr></table></figure><blockquote><p>输出示例</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nvcc: NVIDIA (R) Cuda compiler driver</span><br><span class="line">Copyright (c) 2005-2017 NVIDIA Corporation</span><br><span class="line">Built on Fri_Sep__1_21:08:03_CDT_2017</span><br><span class="line">Cuda compilation tools, release 9.0, V9.0.176</span><br></pre></td></tr></table></figure><h3 id="运行Samples"><a href="#运行Samples" class="headerlink" title="运行Samples"></a>运行Samples</h3><p>以下两个测试结果都为<code>Result=PASS</code>，则说明CUDA安装成功</p><h4 id="deviceQuery"><a href="#deviceQuery" class="headerlink" title="deviceQuery"></a>deviceQuery</h4><h5 id="切换目录"><a href="#切换目录" class="headerlink" title="切换目录"></a>切换目录</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/cuda-9.0/samples/1_Utilities/deviceQuery</span><br></pre></td></tr></table></figure><h5 id="编译运行"><a href="#编译运行" class="headerlink" title="编译运行"></a>编译运行</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; ./deviceQuery</span><br></pre></td></tr></table></figure><h5 id="输出示例"><a href="#输出示例" class="headerlink" title="输出示例"></a>输出示例</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">./deviceQuery Starting...</span><br><span class="line"></span><br><span class="line"> CUDA Device Query (Runtime API) version (CUDART static linking)</span><br><span class="line"></span><br><span class="line">Detected 1 CUDA Capable device(s)</span><br><span class="line"></span><br><span class="line">Device 0: "Tesla P100-PCIE-16GB"</span><br><span class="line">  CUDA Driver Version / Runtime Version          9.1 / 9.0</span><br><span class="line">  CUDA Capability Major/Minor version number:    6.0</span><br><span class="line">  Total amount of global memory:                 16281 MBytes (17071734784 bytes)</span><br><span class="line">  (56) Multiprocessors, ( 64) CUDA Cores/MP:     3584 CUDA Cores</span><br><span class="line">  GPU Max Clock rate:                            1329 MHz (1.33 GHz)</span><br><span class="line">  Memory Clock rate:                             715 Mhz</span><br><span class="line">  Memory Bus Width:                              4096-bit</span><br><span class="line">  L2 Cache Size:                                 4194304 bytes</span><br><span class="line">  Maximum Texture Dimension Size (x,y,z)         1D=(131072), 2D=(131072, 65536), 3D=(16384, 16384, 16384)</span><br><span class="line">  Maximum Layered 1D Texture Size, (num) layers  1D=(32768), 2048 layers</span><br><span class="line">  Maximum Layered 2D Texture Size, (num) layers  2D=(32768, 32768), 2048 layers</span><br><span class="line">  Total amount of constant memory:               65536 bytes</span><br><span class="line">  Total amount of shared memory per block:       49152 bytes</span><br><span class="line">  Total number of registers available per block: 65536</span><br><span class="line">  Warp size:                                     32</span><br><span class="line">  Maximum number of threads per multiprocessor:  2048</span><br><span class="line">  Maximum number of threads per block:           1024</span><br><span class="line">  Max dimension size of a thread block (x,y,z): (1024, 1024, 64)</span><br><span class="line">  Max dimension size of a grid size    (x,y,z): (2147483647, 65535, 65535)</span><br><span class="line">  Maximum memory pitch:                          2147483647 bytes</span><br><span class="line">  Texture alignment:                             512 bytes</span><br><span class="line">  Concurrent copy and kernel execution:          Yes with 2 copy engine(s)</span><br><span class="line">  Run time limit on kernels:                     No</span><br><span class="line">  Integrated GPU sharing Host Memory:            No</span><br><span class="line">  Support host page-locked memory mapping:       Yes</span><br><span class="line">  Alignment requirement for Surfaces:            Yes</span><br><span class="line">  Device has ECC support:                        Enabled</span><br><span class="line">  Device supports Unified Addressing (UVA):      Yes</span><br><span class="line">  Supports Cooperative Kernel Launch:            Yes</span><br><span class="line">  Supports MultiDevice Co-op Kernel Launch:      Yes</span><br><span class="line">  Device PCI Domain ID / Bus ID / location ID:   0 / 0 / 8</span><br><span class="line">  Compute Mode:</span><br><span class="line">     &lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &gt;</span><br><span class="line"></span><br><span class="line">deviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 9.1, CUDA Runtime Version = 9.0, NumDevs = 1</span><br><span class="line">Result = PASS</span><br></pre></td></tr></table></figure><h4 id="bandwidthTest"><a href="#bandwidthTest" class="headerlink" title="bandwidthTest"></a>bandwidthTest</h4><h5 id="切换目录-1"><a href="#切换目录-1" class="headerlink" title="切换目录"></a>切换目录</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/cuda-9.0/samples/1_Utilities/bandwidthTest</span><br></pre></td></tr></table></figure><h5 id="编译运行-1"><a href="#编译运行-1" class="headerlink" title="编译运行"></a>编译运行</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; ./bandwidthTest</span><br></pre></td></tr></table></figure><h5 id="输出示例-1"><a href="#输出示例-1" class="headerlink" title="输出示例"></a>输出示例</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[CUDA Bandwidth Test] - Starting...</span><br><span class="line">Running on...</span><br><span class="line"></span><br><span class="line"> Device 0: Tesla P100-PCIE-16GB</span><br><span class="line"> Quick Mode</span><br><span class="line"></span><br><span class="line"> Host to Device Bandwidth, 1 Device(s)</span><br><span class="line"> PINNED Memory Transfers</span><br><span class="line">   Transfer Size (Bytes)	Bandwidth(MB/s)</span><br><span class="line">   33554432			10731.5</span><br><span class="line"></span><br><span class="line"> Device to Host Bandwidth, 1 Device(s)</span><br><span class="line"> PINNED Memory Transfers</span><br><span class="line">   Transfer Size (Bytes)	Bandwidth(MB/s)</span><br><span class="line">   33554432			12833.8</span><br><span class="line"></span><br><span class="line"> Device to Device Bandwidth, 1 Device(s)</span><br><span class="line"> PINNED Memory Transfers</span><br><span class="line">   Transfer Size (Bytes)	Bandwidth(MB/s)</span><br><span class="line">   33554432			499641.4</span><br><span class="line"></span><br><span class="line">Result = PASS</span><br><span class="line"></span><br><span class="line">NOTE: The CUDA Samples are not meant for performance measurements. Results may vary when GPU Boost is enabled.</span><br></pre></td></tr></table></figure><h2 id="禁用CUDA源"><a href="#禁用CUDA源" class="headerlink" title="禁用CUDA源"></a>禁用CUDA源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --disable cuda</span><br></pre></td></tr></table></figure><h1 id="安装cuDNN"><a href="#安装cuDNN" class="headerlink" title="安装cuDNN"></a>安装cuDNN</h1><h2 id="确定cuDNN下载地址"><a href="#确定cuDNN下载地址" class="headerlink" title="确定cuDNN下载地址"></a>确定cuDNN下载地址</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>访问<a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener">cuDNN Archive</a>，登录之后下载</p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>访问Nvidia托管在Gitlab的<a href="https://gitlab.com/nvidia/container-images/cuda" target="_blank" rel="noopener">容器项目地址</a>，根据自己操作系统的版本，找到对应的Dockerfile，提取cuDNN的下载地址</p><ul><li><a href="https://gitlab.com/nvidia/container-images/cuda/tree/centos6" target="_blank" rel="noopener">CentOS-6</a></li><li><a href="https://gitlab.com/nvidia/container-images/cuda/tree/centos7" target="_blank" rel="noopener">CentOS-7</a></li><li><a href="https://gitlab.com/nvidia/container-images/cuda/tree/ubuntu16.04" target="_blank" rel="noopener">Ubuntu-16.04</a></li><li><a href="https://gitlab.com/nvidia/container-images/cuda/tree/ubuntu18.04" target="_blank" rel="noopener">Ubuntu-18.04</a></li></ul><h2 id="下载cuDNN"><a href="#下载cuDNN" class="headerlink" title="下载cuDNN"></a>下载cuDNN</h2><blockquote><p>这里直接用CUDA-9.0能用到的、最新的<code>cuDNN 7.6.0.64</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O - https://developer.download.nvidia.cn/compute/redist/cudnn/v7.6.0/cudnn-9.0-linux-x64-v7.6.0.64.tgz | tar xz</span><br></pre></td></tr></table></figure><h2 id="安装cuDNN-1"><a href="#安装cuDNN-1" class="headerlink" title="安装cuDNN"></a>安装cuDNN</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp cuda/include/cudnn.h /usr/local/cuda-9.0/include</span><br><span class="line">cp cuda/lib64/libcudnn.so.7.6.0 cuda/lib64/libcudnn_static.a /usr/local/cuda-9.0/lib64</span><br><span class="line">cd /usr/local/cuda-9.0/lib64</span><br><span class="line">ln -sv libcudnn.so.7.6.0 libcudnn.so</span><br><span class="line">ln -sv libcudnn.so.7.6.0 libcudnn.so.7</span><br><span class="line">ldconfig -v</span><br></pre></td></tr></table></figure><h2 id="验证cuDNN"><a href="#验证cuDNN" class="headerlink" title="验证cuDNN"></a>验证cuDNN</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth=1 https://github.com/wilhelmguo/cudnn_samples_v7.git</span><br><span class="line">cd cudnn_samples_v7/mnistCUDNN</span><br><span class="line">make &amp;&amp; ./mnistCUDNN</span><br></pre></td></tr></table></figure><blockquote><p>输出示例</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">cudnnGetVersion() : 7600 , CUDNN_VERSION from cudnn.h : 7600 (7.6.0)</span><br><span class="line">Host compiler version : GCC 4.8.5</span><br><span class="line">There are 1 CUDA capable devices on your machine :</span><br><span class="line">device 0 : sms 56  Capabilities 6.0, SmClock 1328.5 Mhz, MemSize (Mb) 16280, MemClock 715.0 Mhz, Ecc=1, boardGroupID=0</span><br><span class="line">Using device 0</span><br><span class="line"></span><br><span class="line">Testing single precision</span><br><span class="line">Loading image data/one_28x28.pgm</span><br><span class="line">Performing forward propagation ...</span><br><span class="line">Testing cudnnGetConvolutionForwardAlgorithm ...</span><br><span class="line">Fastest algorithm is Algo 1</span><br><span class="line">Testing cudnnFindConvolutionForwardAlgorithm ...</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 0: 0.040256 time requiring 0 memory</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 1: 0.048864 time requiring 3464 memory</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 2: 0.066016 time requiring 57600 memory</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 7: 0.090944 time requiring 2057744 memory</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 5: 0.115776 time requiring 203008 memory</span><br><span class="line">Resulting weights from Softmax:</span><br><span class="line">0.0000000 0.9999399 0.0000000 0.0000000 0.0000561 0.0000000 0.0000012 0.0000017 0.0000010 0.0000000 </span><br><span class="line">Loading image data/three_28x28.pgm</span><br><span class="line">Performing forward propagation ...</span><br><span class="line">Resulting weights from Softmax:</span><br><span class="line">0.0000000 0.0000000 0.0000000 0.9999288 0.0000000 0.0000711 0.0000000 0.0000000 0.0000000 0.0000000 </span><br><span class="line">Loading image data/five_28x28.pgm</span><br><span class="line">Performing forward propagation ...</span><br><span class="line">Resulting weights from Softmax:</span><br><span class="line">0.0000000 0.0000008 0.0000000 0.0000002 0.0000000 0.9999820 0.0000154 0.0000000 0.0000012 0.0000006 </span><br><span class="line"></span><br><span class="line">Result of classification: 1 3 5</span><br><span class="line"></span><br><span class="line">Test passed!</span><br><span class="line"></span><br><span class="line">Testing half precision (math in single precision)</span><br><span class="line">Loading image data/one_28x28.pgm</span><br><span class="line">Performing forward propagation ...</span><br><span class="line">Testing cudnnGetConvolutionForwardAlgorithm ...</span><br><span class="line">Fastest algorithm is Algo 1</span><br><span class="line">Testing cudnnFindConvolutionForwardAlgorithm ...</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 0: 0.045184 time requiring 0 memory</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 1: 0.051328 time requiring 3464 memory</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 2: 0.067872 time requiring 28800 memory</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 7: 0.087776 time requiring 2057744 memory</span><br><span class="line">^^^^ CUDNN_STATUS_SUCCESS for Algo 4: 0.112032 time requiring 207360 memory</span><br><span class="line">Resulting weights from Softmax:</span><br><span class="line">0.0000001 1.0000000 0.0000001 0.0000000 0.0000563 0.0000001 0.0000012 0.0000017 0.0000010 0.0000001 </span><br><span class="line">Loading image data/three_28x28.pgm</span><br><span class="line">Performing forward propagation ...</span><br><span class="line">Resulting weights from Softmax:</span><br><span class="line">0.0000000 0.0000000 0.0000000 1.0000000 0.0000000 0.0000714 0.0000000 0.0000000 0.0000000 0.0000000 </span><br><span class="line">Loading image data/five_28x28.pgm</span><br><span class="line">Performing forward propagation ...</span><br><span class="line">Resulting weights from Softmax:</span><br><span class="line">0.0000000 0.0000008 0.0000000 0.0000002 0.0000000 1.0000000 0.0000154 0.0000000 0.0000012 0.0000006 </span><br><span class="line"></span><br><span class="line">Result of classification: 1 3 5</span><br><span class="line"></span><br><span class="line">Test passed!</span><br></pre></td></tr></table></figure><h1 id="至此安装完毕"><a href="#至此安装完毕" class="headerlink" title="至此安装完毕"></a>至此安装完毕</h1><h1 id="使用阿里云自动安装脚本"><a href="#使用阿里云自动安装脚本" class="headerlink" title="使用阿里云自动安装脚本"></a>使用阿里云自动安装脚本</h1><h2 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h2><ul><li>阿里云在创建GPU计算型实例时，可以通过metadata的方式传入初始化脚本，实现自动安装Nvidia GPU驱动和CUDA</li><li>详细流程可以看阿里云的<a href="https://help.aliyun.com/document_detail/60149.html?spm=a2c4g.11186623.6.609.31771bd1cL1PMA" target="_blank" rel="noopener">操作文档</a></li></ul><h2 id="运行脚本"><a href="#运行脚本" class="headerlink" title="运行脚本"></a>运行脚本</h2><ul><li>驱动版本<code>390.116</code></li><li>CUDA版本<code>9.0.176</code></li><li>cuDNN版本<code>7.5.0</code>（阿里云没提供<code>7.6.0.64</code>的版本，根据文档选择了最新的<code>7.5.0</code>）</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">IS_INSTALL_PERSEUS="TRUE"</span><br><span class="line">DRIVER_VERSION="390.116"</span><br><span class="line">CUDA_VERSION="9.0.176"</span><br><span class="line">CUDNN_VERSION="7.5.0"</span><br><span class="line">IS_INSTALL_RAPIDS="FALSE"</span><br><span class="line"></span><br><span class="line">INSTALL_DIR="/root/auto_install"</span><br><span class="line">log=$&#123;INSTALL_DIR&#125;/nvidia_install.log</span><br><span class="line"></span><br><span class="line">mkdir $INSTALL_DIR &amp;&amp; cd $INSTALL_DIR</span><br><span class="line">script_download_url=$(curl http://100.100.100.200/latest/meta-data/source-address | head -1)"/opsx/ecs/linux/binary/script/auto_install.sh"</span><br><span class="line">wget -t 10 --timeout=10 $script_download_url</span><br><span class="line">sh $&#123;INSTALL_DIR&#125;/$&#123;auto_install_script&#125; $DRIVER_VERSION $CUDA_VERSION $CUDNN_VERSION $IS_INSTALL_PERSEUS $IS_INSTALL_RAPIDS</span><br></pre></td></tr></table></figure></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> 乱愣黎</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://luanlengli.github.io/2019/12/31/阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA.html" title="阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA">https://luanlengli.github.io/2019/12/31/阿里云GPU计算型ECS实例安装NVIDIA驱动和CUDA.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a> <a href="/tags/CUDA/" rel="tag"><i class="fa fa-tag"></i> CUDA</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/12/19/Python-pip命令行设置国内镜像源.html" rel="next" title="Python pip命令行设置国内镜像源"><i class="fa fa-chevron-left"></i> Python pip命令行设置国内镜像源</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="乱愣黎"><p class="site-author-name" itemprop="name">乱愣黎</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">48</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">23</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">30</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/luanlengli" target="_blank" title="GitHub"><i class="fa fa-fw fa-globe"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:huangbopei@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-globe"></i>E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#说明"><span class="nav-number">1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#环境准备"><span class="nav-number">2.</span> <span class="nav-text">环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#禁用SELINUX"><span class="nav-number">2.1.</span> <span class="nav-text">禁用SELINUX</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#禁用防火墙"><span class="nav-number">2.2.</span> <span class="nav-text">禁用防火墙</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加sysctl参数"><span class="nav-number">2.3.</span> <span class="nav-text">添加sysctl参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#fs参数"><span class="nav-number">2.3.1.</span> <span class="nav-text">fs参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vm参数"><span class="nav-number">2.3.2.</span> <span class="nav-text">vm参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#net参数"><span class="nav-number">2.3.3.</span> <span class="nav-text">net参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改limits参数"><span class="nav-number">2.4.</span> <span class="nav-text">修改limits参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改journal设置"><span class="nav-number">2.5.</span> <span class="nav-text">修改journal设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改history参数"><span class="nav-number">2.6.</span> <span class="nav-text">修改history参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新软件"><span class="nav-number">2.7.</span> <span class="nav-text">更新软件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装编译环境"><span class="nav-number">2.8.</span> <span class="nav-text">安装编译环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装常用工具"><span class="nav-number">2.9.</span> <span class="nav-text">安装常用工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#检查GPU"><span class="nav-number">2.10.</span> <span class="nav-text">检查GPU</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看PCI设备"><span class="nav-number">2.10.1.</span> <span class="nav-text">查看PCI设备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看硬件信息"><span class="nav-number">2.10.2.</span> <span class="nav-text">查看硬件信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#禁用nouveau驱动"><span class="nav-number">2.11.</span> <span class="nav-text">禁用nouveau驱动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重启"><span class="nav-number">2.12.</span> <span class="nav-text">重启</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装GPU驱动"><span class="nav-number">3.</span> <span class="nav-text">安装GPU驱动</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#访问Nvidia官网"><span class="nav-number">3.1.</span> <span class="nav-text">访问Nvidia官网</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下载驱动"><span class="nav-number">3.2.</span> <span class="nav-text">下载驱动</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#网页下载"><span class="nav-number">3.2.1.</span> <span class="nav-text">网页下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命令行下载"><span class="nav-number">3.2.2.</span> <span class="nav-text">命令行下载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装驱动"><span class="nav-number">3.3.</span> <span class="nav-text">安装驱动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重启-1"><span class="nav-number">3.4.</span> <span class="nav-text">重启</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#检查驱动情况"><span class="nav-number">3.5.</span> <span class="nav-text">检查驱动情况</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#检查是否加载开源驱动nouveau"><span class="nav-number">3.5.1.</span> <span class="nav-text">检查是否加载开源驱动nouveau</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检查驱动版本"><span class="nav-number">3.5.2.</span> <span class="nav-text">检查驱动版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看GPU信息"><span class="nav-number">3.5.3.</span> <span class="nav-text">查看GPU信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#禁用本地YUM源"><span class="nav-number">3.6.</span> <span class="nav-text">禁用本地YUM源</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装CUDA"><span class="nav-number">4.</span> <span class="nav-text">安装CUDA</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#添加CUDA源"><span class="nav-number">4.1.</span> <span class="nav-text">添加CUDA源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改CUDA源地址"><span class="nav-number">4.2.</span> <span class="nav-text">修改CUDA源地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装CUDA-1"><span class="nav-number">4.3.</span> <span class="nav-text">安装CUDA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置环境变量"><span class="nav-number">4.4.</span> <span class="nav-text">设置环境变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试CUDA"><span class="nav-number">4.5.</span> <span class="nav-text">测试CUDA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看安装路径"><span class="nav-number">4.5.1.</span> <span class="nav-text">查看安装路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检查CUDA版本"><span class="nav-number">4.5.2.</span> <span class="nav-text">检查CUDA版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行Samples"><span class="nav-number">4.5.3.</span> <span class="nav-text">运行Samples</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#deviceQuery"><span class="nav-number">4.5.3.1.</span> <span class="nav-text">deviceQuery</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#切换目录"><span class="nav-number">4.5.3.1.1.</span> <span class="nav-text">切换目录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#编译运行"><span class="nav-number">4.5.3.1.2.</span> <span class="nav-text">编译运行</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#输出示例"><span class="nav-number">4.5.3.1.3.</span> <span class="nav-text">输出示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bandwidthTest"><span class="nav-number">4.5.3.2.</span> <span class="nav-text">bandwidthTest</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#切换目录-1"><span class="nav-number">4.5.3.2.1.</span> <span class="nav-text">切换目录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#编译运行-1"><span class="nav-number">4.5.3.2.2.</span> <span class="nav-text">编译运行</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#输出示例-1"><span class="nav-number">4.5.3.2.3.</span> <span class="nav-text">输出示例</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#禁用CUDA源"><span class="nav-number">4.6.</span> <span class="nav-text">禁用CUDA源</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装cuDNN"><span class="nav-number">5.</span> <span class="nav-text">安装cuDNN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#确定cuDNN下载地址"><span class="nav-number">5.1.</span> <span class="nav-text">确定cuDNN下载地址</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方法一"><span class="nav-number">5.1.1.</span> <span class="nav-text">方法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法二"><span class="nav-number">5.1.2.</span> <span class="nav-text">方法二</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下载cuDNN"><span class="nav-number">5.2.</span> <span class="nav-text">下载cuDNN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装cuDNN-1"><span class="nav-number">5.3.</span> <span class="nav-text">安装cuDNN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证cuDNN"><span class="nav-number">5.4.</span> <span class="nav-text">验证cuDNN</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#至此安装完毕"><span class="nav-number">6.</span> <span class="nav-text">至此安装完毕</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用阿里云自动安装脚本"><span class="nav-number">7.</span> <span class="nav-text">使用阿里云自动安装脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#说明-1"><span class="nav-number">7.1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#运行脚本"><span class="nav-number">7.2.</span> <span class="nav-text">运行脚本</span></a></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">乱愣黎</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">125.2k</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div><span class="post-meta-divider">|</span><div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("Ud2l4uLerav3PFrmAnVI4tDz-gzGzoHsz","vy29JxqPATrJXMXqS1I3nlg1")</script><script>function showTime(e){var t=new AV.Query(e),c=[],u=$(".leancloud_visitors");u.each(function(){c.push($(this).attr("id").trim())}),t.containedIn("url",c),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var n=0;n<e.length;n++){var o=e[n],i=o.get("url"),s=o.get("time"),r=document.getElementById(i);$(r).find(t).text(s)}for(n=0;n<c.length;n++){i=c[n],r=document.getElementById(i);var l=$(r).find(t);""==l.text()&&l.text(0)}}else u.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(i){var e=$(".leancloud_visitors"),s=e.attr("id").trim(),r=e.attr("data-flag-title").trim(),t=new AV.Query(i);t.equalTo("url",s),t.find({success:function(e){if(0<e.length){var t=e[0];t.fetchWhenSave(!0),t.increment("time"),t.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var n=new i,o=new AV.ACL;o.setPublicReadAccess(!0),o.setPublicWriteAccess(!0),n.setACL(o),n.set("title",r),n.set("url",s),n.set("time",1),n.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):1<$(".post-title-link").length&&showTime(e)})</script></body></html>